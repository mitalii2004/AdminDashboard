<%- include("../layout/header.ejs"); %>

<style>
  .musicContainer {
    padding: 1rem;
  }
  .add-music {
    background-color: cadetblue;
    color: white;
    padding: 0.8rem 1.5rem;
    text-decoration: none;
    border-radius: 5px;
    display: inline-block;
    font-size: 1rem;
    margin-bottom: 1rem;
  }
</style>

<div class="musicContainer">
  <a href="/addMusic" class="add-music">+ Add Music</a>
</div>

<table>
  <tr>
    <th>S.No.</th>
    <th>Title</th>
    <th>Description</th>
    <th>Music</th>
    <th>Action</th>
  </tr>

  <% musicData.forEach((music, index) => { %>
  <tr>
    <td><%= index + 1 %></td>
    <td><%= music.title %></td>
    <td><%= music.description %></td>
    <td>
      <audio controls>
        <source src="<%= music.music %>" type="audio/mp3" />
        Your browser does not support the audio element.
      </audio>
    </td>
    <td>
      <form action="/editMusic" method="get" id="<%= music.edit%>">
        <button class="edit-btn">
          <i class="fas fa-edit"></i>
        </button>
      </form>
      <button class="delete-btn" id="<%=music.id%>">
        <i class="fas fa-trash"></i>
      </button>
    </td>
  </tr>
  <% }); %>
</table>
<script
  src="https://code.jquery.com/jquery-3.6.3.min.js"
  integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU="
  crossorigin="anonymous"
></script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".delete-btn").forEach((button) => {
      button.addEventListener("click", function () {
        if (confirm("Are you sure you want to delete this item?")) {
          const row = this.closest("tr");
          if (row) {
            // row.remove();
            $.ajax({
              url: `/deleteMusic/${button.id}`,
              type: "delete",
              success: function (result) {
                if (result.status == 200) {
                  window.location.reload();
                }
              },
            });
          } else {
            console.error("No row found to delete.");
          }
        }
      });
    });
  });
</script>

<%- include("../layout/footer.ejs"); %>
